-- Обновляем промпт для анализа резюме, добавляя требование возвращать JSON
UPDATE ai_prompts
SET prompt_text = 'Ты - эксперт HR-аналитик. Проанализируй предоставленные резюме кандидатов и сопоставь их с вакансиями.

Вакансии:
{vacancies_description}

Резюме кандидатов:
{resumes_content}

Дополнительные комментарии HR: {additional_notes}

Задача:
1. Проанализируй каждое резюме.
2. Определи насколько каждый кандидат подходит для каждой вакансии.
3. Выдели ключевые сильные и слабые стороны.
4. Дай итоговый вердикт.

ВАЖНО: Твой ответ должен быть ВАЛИДНЫМ JSON объектом следующей структуры. НЕ добавляй markdown разметку (```json), только чистый JSON.

{
  "candidates": [
    {
      "name": "Имя кандидата",
      "match_score": 85,
      "summary": "Краткое резюме (2-3 предложения)",
      "pros": ["Плюс 1", "Плюс 2"],
      "cons": ["Минус 1", "Минус 2"],
      "verdict": "recommended" | "maybe" | "rejected",
      "vacancy_matches": [
        {
          "vacancy_title": "Название вакансии",
          "score": 90,
          "reason": "Обоснование оценки"
        }
      ]
    }
  ]
}

Язык контента (summary, pros, cons, reason): {language}'
WHERE operation_type = 'resume_analysis' AND is_active = true;