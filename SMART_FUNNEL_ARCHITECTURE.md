# ะััะธัะตะบัััะฐ "ะฃะผะฝะพะน ะฒะพัะพะฝะบะธ" ั AI-ะธะฝัะตะณัะฐัะธะตะน

**ะะฐัะฐ:** 09.12.2025  
**ะะตััะธั:** 1.0  
**ะกัะฐััั:** ๐ฏ Design Phase

---

## ๐ ะะะะะะะะ

### ะขะตะบััะตะต ัะพััะพัะฝะธะต:
- โ ะัะต ะบะฐะฝะดะธะดะฐัั ะทะฐัััะตะฒะฐัั ะฝะฐ ััะฐัััะต `invited`
- โ ะะตั ะฐะฒัะพะผะฐัะธัะตัะบะธั ะฟะตัะตัะพะดะพะฒ (testing โ evaluated)
- โ AI-ััะฝะบัะธะธ ัะฐะทัะพะทะฝะตะฝั (ะฐะฝะฐะปะธะท, ััะฐะฒะฝะตะฝะธะต, ะดะพะบัะผะตะฝัั, ะธะฝัะตัะฒัั)
- โ ะกััะฐะฝะธัะฐ ะฟัะพัะธะปั ะบะฐะฝะดะธะดะฐัะฐ ะฟะตัะตะณััะถะตะฝะฐ ะบะฝะพะฟะบะฐะผะธ ะณะตะฝะตัะฐัะธะธ
- โ HR ะฝะต ะฒะธะดะธั ะฟัะพะณัะตััะฐ ะบะฐะฝะดะธะดะฐัะฐ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- โ ะะฝัะตัะฒัั ั ัะตะบะพะผะตะฝะดะฐัะธัะผะธ ะฝะต ัะฒัะทะฐะฝะพ ั ะฒะพัะพะฝะบะพะน

### ะะพะปัะทะพะฒะฐัะตะปััะบะธะต ะถะฐะปะพะฑั:
> "ะะพัะพะฝะบะฐ ะฝะต ัะฐะฑะพัะฐะตั - ะฒัะต ะฝะฐ ะฟะตัะฒะพะผ ััะฐะฟะต"  
> "ะะตะฝะตัะฐัะธั ะดะพะบัะผะตะฝัะพะฒ ััะพะธั ะพัะพะฑะฝััะบะพะผ"  
> "ะะต ะฟะพะฝััะฝะพ, ะบะพะณะดะฐ ะบะฐะฝะดะธะดะฐั ะณะพัะพะฒ ะบ ัะปะตะดัััะตะผั ัะฐะณั"

---

## ๐ฏ ะะะจะะะะ: "ะฃะผะฝะฐั ะฒะพัะพะฝะบะฐ ั AI-ะฐััะธััะตะฝัะพะผ"

### ะะพะฝัะตะฟัะธั:
**ะะพัะพะฝะบะฐ ััะฐะฝะพะฒะธััั ัะตะฝััะพะผ ัะฟัะฐะฒะปะตะฝะธั ะฟัะพัะตััะพะผ ะฝะฐะนะผะฐ**, ะณะดะต:
1. ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะฒะธะณะฐะตั ะบะฐะฝะดะธะดะฐัะฐ ะฟะพ ัััะธะฝะฝัะผ ััะฐะฟะฐะผ
2. AI-ััะฝะบัะธะธ ะฒัััะพะตะฝั ะฟััะผะพ ะฒ ะบะฐััะพัะบะธ (ะบะพะฝัะตะบััะฝัะต ะดะตะนััะฒะธั)
3. ะฃะผะฝัะต badges ะฟะพะบะฐะทัะฒะฐัั ัะตะบััะธะน ััะฐััั ะธ ะณะพัะพะฒะฝะพััั ะบ ัะปะตะดัััะตะผั ัะฐะณั
4. ะกััะฐะฝะธัะฐ ะฟัะพัะธะปั = ะธััะพัะธั ะธ ะดะตัะฐะปะธ, ะฑะตะท ะดัะฑะปะธัะพะฒะฐะฝะธั

---

## ๐ ะะะะซะ FLOW ะะะะะะะ

### ะะฑัะฐั ััะตะผะฐ ััะฐัััะพะฒ:

```mermaid
graph LR
    A[Invited] -->|ะะฒัะพะผะฐัะธัะตัะบะธ<br/>ะฝะฐัะฐะป ะฟะตัะฒัะน ัะตัั| B[Testing]
    B -->|ะะฒัะพะผะฐัะธัะตัะบะธ<br/>ะทะฐะฒะตััะธะป 6/6 ัะตััะพะฒ| C[Evaluated]
    C -->|HR ะดะตะนััะฒะธะต<br/>ัะณะตะฝะตัะธัะพะฒะฐัั ะธะฝัะตัะฒัั| D[Interview]
    D -->|ะะฒัะพะผะฐัะธัะตัะบะธ<br/>recommendation: hire*| E[Offer]
    D -->|ะะฒัะพะผะฐัะธัะตัะบะธ<br/>recommendation: reject| F[Rejected]
    D -->|recommendation: consider| D
    E -->|HR ะดะตะนััะฒะธะต<br/>ะฟัะธะฝัะป ะพััะตั| G[Hired]
    E -->|HR ะดะตะนััะฒะธะต<br/>ะพัะบะฐะทะฐะปัั| F
    
    A -.->|HR ะดะตะนััะฒะธะต<br/>ะฒ ะปัะฑะพะน ะผะพะผะตะฝั| F
    B -.->|HR ะดะตะนััะฒะธะต<br/>ะฒ ะปัะฑะพะน ะผะพะผะตะฝั| F
    C -.->|HR ะดะตะนััะฒะธะต<br/>ะฒ ะปัะฑะพะน ะผะพะผะตะฝั| F
```

### ะะตัะฐะปัะฝะฐั ะปะพะณะธะบะฐ ะฟะพ ััะฐัััะฐะผ:

#### 1๏ธโฃ INVITED (ะัะธะณะปะฐััะฝ)
**ะะฒัะพะผะฐัะธัะตัะบะธะน ะฟะตัะตัะพะด:** โ `testing` ะฟัะธ `tests_completed > 0`

**UI ัะปะตะผะตะฝัั ะบะฐััะพัะบะธ:**
- ะะฐะทะพะฒะฐั ะธะฝัะพัะผะฐัะธั (ะธะผั, ะบะฐัะตะณะพัะธั)
- Badge: "ะะถะธะดะฐะตั ะฝะฐัะฐะปะฐ ัะตััะธัะพะฒะฐะฝะธั" (ัะตััะน)
- ะะตะนััะฒะธั: "ะัะพัะธะปั" | "ะงะฐั" | "ะะตัะตะผะตััะธัั ะฒัััะฝัั"

**ะขัะธะณะณะตั (DB):**
```sql
-- ะัะธ INSERT/UPDATE ะฒ candidate_test_results
IF (SELECT COUNT(*) FROM candidate_test_results 
    WHERE candidate_id = NEW.candidate_id) > 0 THEN
  -- ะะฑะฝะพะฒะปัะตะผ ะฒัะต applications ะณะดะต ััะฐััั = invited
  UPDATE applications 
  SET status = 'testing', updated_at = NOW()
  WHERE candidate_id = NEW.candidate_id 
    AND status = 'invited';
END IF;
```

---

#### 2๏ธโฃ TESTING (ะัะพัะพะดะธั ัะตััั)
**ะะฒัะพะผะฐัะธัะตัะบะธะน ะฟะตัะตัะพะด:** โ `evaluated` ะฟัะธ `tests_completed = 6`

**UI ัะปะตะผะตะฝัั ะบะฐััะพัะบะธ:**
- ะัะพะณัะตัั-ะฑะฐั: X/6 ัะตััะพะฒ (ัะตะฐะปัะฝะพะต ะฒัะตะผั)
- Badge ะดะธะฝะฐะผะธัะตัะบะธะน:
  - "1-2/6" โ Badge ัะธะฝะธะน "ะะฐัะฐะป ัะตััะธัะพะฒะฐะฝะธะต"
  - "3-4/6" โ Badge ัะธะพะปะตัะพะฒัะน "ะัะพัะพะดะธั ัะตััั"
  - "5/6" โ Badge ะพัะฐะฝะถะตะฒัะน "ะะพััะธ ะทะฐะฒะตััะธะป" + ะฟัะปััะฐัะธั
- ะะตะนััะฒะธั: "ะัะพัะธะปั" | "ะงะฐั" | "ะะตัะตะผะตััะธัั"

**ะขัะธะณะณะตั (DB):**
```sql
-- ะัะธ ะทะฐะฒะตััะตะฝะธะธ ัะตััะฐ, ะฟัะพะฒะตััะตะผ ะพะฑัะตะต ะบะพะปะธัะตััะฒะพ
IF (SELECT tests_completed FROM candidates 
    WHERE id = NEW.candidate_id) = 6 THEN
  -- ะะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะฒะพะดะธะผ ะฒ evaluated
  UPDATE applications 
  SET status = 'evaluated', updated_at = NOW()
  WHERE candidate_id = NEW.candidate_id 
    AND status = 'testing';
END IF;
```

---

#### 3๏ธโฃ EVALUATED (ะัะตะฝัะฝ - ัะตััั ะทะฐะฒะตััะตะฝั)
**ะััะฝะพะน ะฟะตัะตัะพะด:** HR ะฟัะธะฝะธะผะฐะตั ัะตัะตะฝะธะต

**UI ัะปะตะผะตะฝัั ะบะฐััะพัะบะธ:**
- Badge: "ะัะต ัะตััั ะฟัะพะนะดะตะฝั" (ะทะตะปะตะฝัะน) + ะธะบะพะฝะบะฐ CheckCircle
- **ะะพะฒัะน ะฑะปะพะบ "AI-ะฟะพะผะพัะฝะธะบ":**
  - ะัะปะธ ะะะข ะฟะพะปะฝะพะณะพ ะฐะฝะฐะปะธะทะฐ: ะบะฝะพะฟะบะฐ "๐ ะะพะปะฝัะน ะฐะฝะฐะปะธะท" (ััะบะฐั, emerald)
  - ะัะปะธ ะะกะขะฌ ะฐะฝะฐะปะธะท: badge "ะะฝะฐะปะธะท ะณะพัะพะฒ" + ะบะฝะพะฟะบะฐ "ะัะพัะผะพััะตัั"
- **ะะพะฝัะตะบััะฝัะต ะดะตะนััะฒะธั:**
  - ะะฝะพะฟะบะฐ "๐ ะัะธะณะปะฐัะธัั ะฝะฐ ะธะฝัะตัะฒัั" โ ะณะตะฝะตัะธััะตั interview_session + ะฟะตัะตะฒะพะดะธั ะฒ `interview`
  - ะะฝะพะฟะบะฐ "โ ะัะบะปะพะฝะธัั" โ ะดะธะฐะปะพะณ ะพัะบะฐะทะฐ
- ะกัะฐะฝะดะฐััะฝัะต: "ะัะพัะธะปั" | "ะงะฐั" | "ะะตัะตะผะตััะธัั"

**ะะพะณะธะบะฐ ะบะฝะพะฟะบะธ "ะัะธะณะปะฐัะธัั ะฝะฐ ะธะฝัะตัะฒัั":**
1. ะัะพะฒะตััะตั ะฝะฐะปะธัะธะต `interview_sessions` ะดะปั ััะพะณะพ ะบะฐะฝะดะธะดะฐัะฐ + ะฒะฐะบะฐะฝัะธะธ
2. ะัะปะธ ะะะข โ ะฒัะทัะฒะฐะตั Edge Function `generate-structured-interview`
3. ะกะพะทะดะฐะตััั session ัะพ ััะฐัััะพะผ `planned`
4. **ะะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะฒะพะดะธั** application ะฒ ััะฐััั `interview`
5. Toast: "ะะปะฐะฝ ะธะฝัะตัะฒัั ะณะพัะพะฒ. ะะฐะฝะดะธะดะฐั ะฟะตัะตะผะตัะตะฝ ะฒ 'ะะฐ ะธะฝัะตัะฒัั'"

---

#### 4๏ธโฃ INTERVIEW (ะะฐ ะธะฝัะตัะฒัั)
**ะะฒัะพะผะฐัะธัะตัะบะธะน ะฟะตัะตัะพะด:** ะทะฐะฒะธัะธั ะพั ะทะฐะฒะตััะตะฝะธั ะธะฝัะตัะฒัั

**UI ัะปะตะผะตะฝัั ะบะฐััะพัะบะธ (ะะ ะทะฐะฒะตััะตะฝะธั ะธะฝัะตัะฒัั):**
- Badge: "ะะฝัะตัะฒัั ะทะฐะฟะปะฐะฝะธัะพะฒะฐะฝะพ" (ัะธะฝะธะน) + ะธะบะพะฝะบะฐ Calendar
- ะะฝะพะฟะบะฐ: "๐ ะัะพะฒะตััะธ ะธะฝัะตัะฒัั" โ ะพัะบััะฒะฐะตั `InterviewWorkspace`
- ะะตะนััะฒะธั: "ะัะพัะธะปั" | "ะงะฐั"

**UI ัะปะตะผะตะฝัั ะบะฐััะพัะบะธ (ะะะกะะ ะทะฐะฒะตััะตะฝะธั ะธะฝัะตัะฒัั):**
- Badge ั ัะตะบะพะผะตะฝะดะฐัะธะตะน (ัะฒะตั ะทะฐะฒะธัะธั ะพั ัะธะฟะฐ):
  - `hire_strongly` โ "ะะฐะฝััั ะฝะตะผะตะดะปะตะฝะฝะพ!" (ะทะตะปะตะฝัะน, ะฟัะปััะธััะตั)
  - `hire` โ "ะะตะบะพะผะตะฝะดะพะฒะฐะฝ ะบ ะฝะฐะนะผั" (ัะธะฝะธะน)
  - `consider` โ "ะขัะตะฑัะตั ะพะฑััะถะดะตะฝะธั" (ะถะตะปััะน)
  - `reject` โ ะฐะฒัะพะผะฐัะพะผ ะฟะตัะตัะพะดะธั ะฒ `rejected`
- **ะะพะฝัะตะบััะฝัะต ะดะตะนััะฒะธั:**
  - ะะปั `hire_strongly`/`hire`: ััะบะฐั ะบะฝะพะฟะบะฐ "๐ผ ะัะฟัะฐะฒะธัั ะพััะตั"
  - ะะปั `consider`: ะบะฝะพะฟะบะฐ "๐ฅ ะะฑััะดะธัั ั ะบะพะผะฐะฝะดะพะน" (ะพัะบััะฒะฐะตั ัะฐั ะบะพะผะฐะฝะดั - feature)
  - ะะฝะพะฟะบะฐ "๐ ะัะพัะผะพััะตัั ะฟัะพัะพะบะพะป" โ ะพัะบััะฒะฐะตั ะทะฐะฒะตััะตะฝะฝะพะต ะธะฝัะตัะฒัั
- ะกัะฐะฝะดะฐััะฝัะต: "ะัะพัะธะปั" | "ะงะฐั"

**ะะฒัะพะผะฐัะธะบะฐ ะฟัะธ ะทะฐะฒะตััะตะฝะธะธ ะธะฝัะตัะฒัั:**
```typescript
// ะ InterviewCompletionDialog ะฟะพัะปะต ััะฟะตัะฝะพะณะพ ัะพััะฐะฝะตะฝะธั:
if (recommendation === 'reject') {
  // ะะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะฒะพะดะธะผ ะฒ rejected
  await updateApplicationStatus(applicationId, 'rejected')
  // ะัะตะดะปะฐะณะฐะตะผ ัะณะตะฝะตัะธัะพะฒะฐัั ะฟะธััะผะพ-ะพัะบะฐะท
  showGenerateRejectionDialog()
}
// ะะปั ะพััะฐะปัะฝัั - ะพััะฐะตะผัั ะฒ interview, ะฟะพะบะฐะทัะฒะฐะตะผ badge
```

---

#### 5๏ธโฃ OFFER (ะััะตั ะพัะฟัะฐะฒะปะตะฝ)
**ะััะฝะพะน ะฟะตัะตัะพะด:** โ `hired` ะธะปะธ `rejected`

**UI ัะปะตะผะตะฝัั ะบะฐััะพัะบะธ:**
- Badge: "ะััะตั ะพัะฟัะฐะฒะปะตะฝ" (ะทะตะปะตะฝัะน) + ะธะบะพะฝะบะฐ FileCheck
- ะะฝัะพัะผะฐัะธั: ะดะฐัะฐ ะพัะฟัะฐะฒะบะธ ะพััะตัะฐ (ะธะท ะดะพะบัะผะตะฝัะฐ)
- ะะตะนััะฒะธั:
  - "โ ะัะธะฝัะป ะพััะตั" โ ะฟะตัะตะฒะพะดะธั ะฒ `hired`
  - "โ ะัะบะฐะทะฐะปัั" โ ะฟะตัะตะฒะพะดะธั ะฒ `rejected`
  - "๐ ะัะพัะผะพััะตัั ะพััะตั"
  - "ะัะพัะธะปั" | "ะงะฐั"

---

#### 6๏ธโฃ HIRED (ะะฐะฝัั) โ
**ะคะธะฝะฐะปัะฝัะน ััะฐััั** - ััะฟะตั!

**UI ัะปะตะผะตะฝัั ะบะฐััะพัะบะธ:**
- Badge: "ะะฐะฝัั" (ัะตะผะฝะพ-ะทะตะปะตะฝัะน) + ะธะบะพะฝะบะฐ Trophy
- ะะฐัะฐ ะฝะฐะนะผะฐ
- ะะฟัะธะพะฝะฐะปัะฝะพ: ะฟะพะทะดัะฐะฒะธัะตะปัะฝะพะต ะบะพะฝัะตััะธ (ะฐะฝะธะผะฐัะธั)
- ะะตะนััะฒะธั: "ะัะพัะธะปั" | "ะงะฐั"

---

#### 7๏ธโฃ REJECTED (ะัะบะปะพะฝัะฝ) โ
**ะคะธะฝะฐะปัะฝัะน ััะฐััั** - ะพัะบะฐะท

**UI ัะปะตะผะตะฝัั ะบะฐััะพัะบะธ:**
- Badge: "ะัะบะปะพะฝัะฝ" (ะบัะฐัะฝัะน) + ะธะบะพะฝะบะฐ X
- ะัะธัะธะฝะฐ (ะตัะปะธ ัะบะฐะทะฐะฝะฐ)
- ะะฝัะพัะผะฐัะธั: ะฟะธััะผะพ-ะพัะบะฐะท ะพัะฟัะฐะฒะปะตะฝะพ (ะดะฐ/ะฝะตั)
- ะะตะนััะฒะธั: ัะพะปัะบะพ "ะัะพัะธะปั"

---

## ๐๏ธ ะะะะะะะะะฏ ะ ะะะะ ะะะะะซะฅ

### 1. ะะพะฒะฐั ัะฐะฑะปะธัะฐ: `application_timeline`

ะฅัะฐะฝะธะผ ะธััะพัะธั ะฒัะตั ัะพะฑััะธะน ะฟะพ ะบะฐะฝะดะธะดะฐัั:

```sql
CREATE TABLE public.application_timeline (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  created_at timestamptz DEFAULT now() NOT NULL,
  
  -- Relations
  application_id uuid REFERENCES public.applications(id) ON DELETE CASCADE NOT NULL,
  
  -- Event
  event_type text NOT NULL CHECK (event_type IN (
    'status_changed',
    'analysis_generated',
    'interview_planned',
    'interview_started',
    'interview_completed',
    'document_generated',
    'document_sent',
    'note_added'
  )),
  
  old_status text,
  new_status text,
  
  -- Metadata
  triggered_by text NOT NULL CHECK (triggered_by IN ('system', 'hr', 'candidate')),
  hr_specialist_id uuid REFERENCES public.hr_specialists(id),
  
  details jsonb, -- ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะดะฐะฝะฝัะต (recommendation, document_id, etc.)
  notes text
);

CREATE INDEX idx_timeline_application ON public.application_timeline(application_id, created_at DESC);
CREATE INDEX idx_timeline_event_type ON public.application_timeline(event_type);
```

### 2. ะะฐััะธัะตะฝะธะต ัะฐะฑะปะธัั `applications`

```sql
ALTER TABLE public.applications 
ADD COLUMN has_full_analysis boolean DEFAULT false,
ADD COLUMN latest_interview_id uuid REFERENCES public.interview_sessions(id),
ADD COLUMN interview_recommendation text CHECK (interview_recommendation IN ('hire_strongly', 'hire', 'consider', 'reject')),
ADD COLUMN sent_documents jsonb DEFAULT '[]'::jsonb; -- ['offer', 'rejection_letter']

-- ะะฝะดะตะบัั
CREATE INDEX idx_applications_has_analysis ON public.applications(has_full_analysis) WHERE has_full_analysis = true;
CREATE INDEX idx_applications_interview_rec ON public.applications(interview_recommendation) WHERE interview_recommendation IS NOT NULL;
```

### 3. ะะพะฒัะน ััะธะณะณะตั: ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฟะตัะตัะพะด statuses

```sql
-- ะคัะฝะบัะธั ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะพะฑะฝะพะฒะปะตะฝะธั ััะฐัััะฐ applications
CREATE OR REPLACE FUNCTION public.auto_update_application_status()
RETURNS trigger
LANGUAGE plpgsql
AS $$
DECLARE
  v_application_id uuid;
  v_tests_count integer;
BEGIN
  -- ะัะธ ะธะทะผะตะฝะตะฝะธะธ tests_completed ะฒ candidates
  IF TG_TABLE_NAME = 'candidates' THEN
    -- ะะฐะนัะธ ะฒัะต applications ะดะปั ััะพะณะพ ะบะฐะฝะดะธะดะฐัะฐ
    FOR v_application_id IN 
      SELECT id FROM applications WHERE candidate_id = NEW.id
    LOOP
      v_tests_count := NEW.tests_completed;
      
      -- invited โ testing (ะฟัะธ ะฟะตัะฒะพะผ ัะตััะต)
      IF v_tests_count > 0 THEN
        UPDATE applications
        SET status = 'testing', updated_at = NOW()
        WHERE id = v_application_id AND status = 'invited';
        
        -- ะะพะณะธััะตะผ ะฒ timeline
        INSERT INTO application_timeline (application_id, event_type, old_status, new_status, triggered_by)
        VALUES (v_application_id, 'status_changed', 'invited', 'testing', 'system');
      END IF;
      
      -- testing โ evaluated (ะฟัะธ 6/6)
      IF v_tests_count = 6 THEN
        UPDATE applications
        SET status = 'evaluated', updated_at = NOW()
        WHERE id = v_application_id AND status = 'testing';
        
        -- ะะพะณะธััะตะผ
        INSERT INTO application_timeline (application_id, event_type, old_status, new_status, triggered_by)
        VALUES (v_application_id, 'status_changed', 'testing', 'evaluated', 'system');
      END IF;
    END LOOP;
  END IF;
  
  RETURN NEW;
END;
$$;

-- ะขัะธะณะณะตั ะฝะฐ ะธะทะผะตะฝะตะฝะธะต candidates
DROP TRIGGER IF EXISTS auto_update_application_on_tests ON candidates;
CREATE TRIGGER auto_update_application_on_tests
  AFTER INSERT OR UPDATE OF tests_completed ON candidates
  FOR EACH ROW
  EXECUTE FUNCTION public.auto_update_application_status();
```

### 4. ะะพะฒะฐั RPC: ัะฒัะทัะฒะฐะฝะธะต ะธะฝัะตัะฒัั ั ะฒะพัะพะฝะบะพะน

```sql
CREATE OR REPLACE FUNCTION public.link_interview_to_application(
  p_session_id uuid
)
RETURNS jsonb
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  v_application_id uuid;
  v_recommendation text;
  v_candidate_id uuid;
  v_vacancy_id uuid;
BEGIN
  -- ะะพะปััะฐะตะผ ะดะฐะฝะฝัะต ะทะฐะฒะตััะตะฝะฝะพะณะพ ะธะฝัะตัะฒัั
  SELECT 
    candidate_id, 
    vacancy_id,
    (session_data->'completion'->>'recommendation')::text
  INTO v_candidate_id, v_vacancy_id, v_recommendation
  FROM interview_sessions
  WHERE id = p_session_id AND status = 'completed';
  
  IF NOT FOUND THEN
    RETURN jsonb_build_object('success', false, 'error', 'Interview not found or not completed');
  END IF;
  
  -- ะะฐัะพะดะธะผ application
  SELECT id INTO v_application_id
  FROM applications
  WHERE candidate_id = v_candidate_id 
    AND vacancy_id = v_vacancy_id;
  
  IF NOT FOUND THEN
    RETURN jsonb_build_object('success', false, 'error', 'Application not found');
  END IF;
  
  -- ะะฑะฝะพะฒะปัะตะผ application
  UPDATE applications
  SET 
    latest_interview_id = p_session_id,
    interview_recommendation = v_recommendation,
    updated_at = NOW()
  WHERE id = v_application_id;
  
  -- ะัะปะธ ัะตะบะพะผะตะฝะดะฐัะธั reject - ะฐะฒัะพะผะฐัะพะผ ะฒ rejected
  IF v_recommendation = 'reject' THEN
    UPDATE applications
    SET status = 'rejected', updated_at = NOW()
    WHERE id = v_application_id;
    
    -- ะะพะณะธััะตะผ
    INSERT INTO application_timeline (application_id, event_type, old_status, new_status, triggered_by, details)
    VALUES (v_application_id, 'status_changed', 'interview', 'rejected', 'system', 
            jsonb_build_object('reason', 'interview_recommendation_reject'));
  END IF;
  
  -- ะะพะณะธััะตะผ ะทะฐะฒะตััะตะฝะธะต ะธะฝัะตัะฒัั
  INSERT INTO application_timeline (application_id, event_type, triggered_by, details)
  VALUES (v_application_id, 'interview_completed', 'hr', 
          jsonb_build_object('session_id', p_session_id, 'recommendation', v_recommendation));
  
  RETURN jsonb_build_object(
    'success', true, 
    'application_id', v_application_id,
    'recommendation', v_recommendation
  );
END;
$$;
```

---

## ๐จ ะะะะซะ UI ะะะะะะะ

### ะะฐััะธัะตะฝะฝะฐั ะบะฐััะพัะบะฐ ะบะฐะฝะดะธะดะฐัะฐ

```tsx
interface EnhancedCandidateCard {
  application: Application & {
    candidate: Candidate & { tests_completed: number }
    has_full_analysis: boolean
    latest_interview_id: string | null
    interview_recommendation: 'hire_strongly' | 'hire' | 'consider' | 'reject' | null
    sent_documents: string[] // ['offer', 'rejection_letter']
  }
}

export const SmartCandidateCard = ({ application }: EnhancedCandidateCard) => {
  // ะะธะฝะฐะผะธัะตัะบะธ ะพะฟัะตะดะตะปัะตะผ ะดะพัััะฟะฝัะต ะดะตะนััะฒะธั ะฝะฐ ะพัะฝะพะฒะต ััะฐัััะฐ
  const getContextActions = () => {
    const { status, candidate, has_full_analysis, interview_recommendation } = application
    
    switch(status) {
      case 'evaluated':
        return [
          !has_full_analysis && {
            label: 'ะะพะปะฝัะน ะฐะฝะฐะปะธะท',
            icon: Bot,
            variant: 'default',
            color: 'emerald',
            action: () => openGenerateAnalysisDialog()
          },
          {
            label: 'ะัะธะณะปะฐัะธัั ะฝะฐ ะธะฝัะตัะฒัั',
            icon: Calendar,
            variant: 'default',
            action: () => handleInviteToInterview()
          }
        ]
      
      case 'interview':
        if (!interview_recommendation) {
          return [{
            label: 'ะัะพะฒะตััะธ ะธะฝัะตัะฒัั',
            icon: PlayCircle,
            variant: 'default',
            action: () => openInterviewWorkspace()
          }]
        } else if (interview_recommendation === 'hire_strongly' || interview_recommendation === 'hire') {
          return [{
            label: 'ะัะฟัะฐะฒะธัั ะพััะตั',
            icon: FileCheck,
            variant: 'default',
            color: 'emerald',
            pulsate: true,
            action: () => handleSendOffer()
          }]
        }
        return []
      
      case 'offer':
        return [
          {
            label: 'ะัะธะฝัะป ะพััะตั โ ะะฐะฝััั',
            icon: Trophy,
            variant: 'default',
            color: 'green',
            action: () => handleHire()
          },
          {
            label: 'ะัะบะฐะทะฐะปัั',
            icon: X,
            variant: 'outline',
            action: () => handleReject()
          }
        ]
      
      default:
        return []
    }
  }
  
  return (
    <Card className="...">
      {/* Header ั ะฐะฒะฐัะฐัะพะผ ะธ ะธะผะตะฝะตะผ */}
      
      {/* AI Status Badges */}
      <div className="space-y-1">
        {renderDynamicBadges()}
      </div>
      
      {/* ะะพะฝัะตะบััะฝัะต ะดะตะนััะฒะธั (ะฑะพะปััะธะต ะบะฝะพะฟะบะธ) */}
      <div className="space-y-2 pt-2">
        {getContextActions().filter(Boolean).map(action => (
          <Button 
            key={action.label}
            className={cn("w-full", action.pulsate && "animate-pulse")}
            variant={action.variant}
            onClick={action.action}
          >
            <action.icon className="h-4 w-4 mr-2" />
            {action.label}
          </Button>
        ))}
      </div>
      
      {/* ะกัะฐะฝะดะฐััะฝัะต ะดะตะนััะฒะธั (ะผะตะปะบะธะต) */}
      <div className="flex gap-2 pt-2 border-t">
        <Button size="sm" variant="ghost">ะัะพัะธะปั</Button>
        <Button size="sm" variant="ghost">ะงะฐั</Button>
      </div>
    </Card>
  )
}
```

### ะะธะฝะฐะผะธัะตัะบะธะต badges

```tsx
const renderDynamicBadges = () => {
  const badges = []
  
  // 1. ะัะพะณัะตัั ัะตััะพะฒ (ะดะปั testing)
  if (status === 'testing') {
    const progress = candidate.tests_completed
    badges.push(
      <Badge variant={progress < 3 ? 'default' : progress < 5 ? 'secondary' : 'warning'}>
        {progress}/6 ัะตััะพะฒ
      </Badge>
    )
  }
  
  // 2. ะัะต ัะตััั ะทะฐะฒะตััะตะฝั (ะดะปั evaluated)
  if (status === 'evaluated') {
    badges.push(
      <Badge variant="success" className="gap-1">
        <CheckCircle className="h-3 w-3" />
        6/6 ัะตััะพะฒ
      </Badge>
    )
  }
  
  // 3. ะกัะฐััั ะฐะฝะฐะปะธะทะฐ (ะดะปั evaluated/interview)
  if ((status === 'evaluated' || status === 'interview') && !has_full_analysis) {
    badges.push(
      <Badge variant="outline" className="text-amber-600 border-amber-600">
        ะะฝะฐะปะธะท ะฝะต ะฟัะพะฒะตะดะตะฝ
      </Badge>
    )
  }
  
  // 4. ะะตะบะพะผะตะฝะดะฐัะธั ะธะฝัะตัะฒัั (ะดะปั interview)
  if (status === 'interview' && interview_recommendation) {
    const configs = {
      hire_strongly: { label: 'ะะฐะฝััั ะฝะตะผะตะดะปะตะฝะฝะพ!', color: 'bg-emerald-600', pulsate: true },
      hire: { label: 'ะะตะบะพะผะตะฝะดะพะฒะฐะฝ', color: 'bg-blue-600' },
      consider: { label: 'ะขัะตะฑัะตั ะพะฑััะถะดะตะฝะธั', color: 'bg-amber-600' }
    }
    const config = configs[interview_recommendation]
    
    badges.push(
      <Badge className={cn(config.color, config.pulsate && "animate-pulse")}>
        <Sparkles className="h-3 w-3 mr-1" />
        {config.label}
      </Badge>
    )
  }
  
  return badges.map((badge, i) => <div key={i}>{badge}</div>)
}
```

---

## ๐ ะฃะะะะฉะะะะ ะกะขะะะะะฆะซ ะะะะคะะะฏ

### ะัะปะพ (ะฟะตัะตะณััะถะตะฝะพ):
```
โโโ ะะฝะพะฟะบะธ ะดะตะนััะฒะธะน (ะฟัะฐะฒะฐั ะบะพะปะพะฝะบะฐ)
โ   โโโ ะะฐะฟะธัะฐัั ัะพะพะฑัะตะฝะธะต โ (ะพััะฐะฒะธัั)
โ   โโโ ะะพะปะฝัะน ะฐะฝะฐะปะธะท (AI) โ (ัะฑัะฐัั, ะฑัะดะตั ะฒ ะฒะพัะพะฝะบะต)
โ   โโโ ะกะณะตะฝะตัะธัะพะฒะฐัั ะดะพะบัะผะตะฝั โ (ัะฑัะฐัั, ะฑัะดะตั ะฒ ะฒะพัะพะฝะบะต)
โ   โโโ ะกะณะตะฝะตัะธัะพะฒะฐัั ะธะฝัะตัะฒัั โ (ัะฑัะฐัั, ะฑัะดะตั ะฒ ะฒะพัะพะฝะบะต)
โโโ ะััะพัะธั ะฐะฝะฐะปะธะทะพะฒ (ะพัะฝะพะฒะฝะฐั ะบะพะปะพะฝะบะฐ) โ (ะพััะฐะฒะธัั)
โโโ ะััะพัะธั ะดะพะบัะผะตะฝัะพะฒ โ (ะพััะฐะฒะธัั)
โโโ ะััะพัะธั ะธะฝัะตัะฒัั โ (ะพััะฐะฒะธัั)
```

### ะกัะฐะฝะตั (ัะพะบัั ะฝะฐ ะฟัะพัะผะพััะต):
```
ะัะพัะธะปั ะบะฐะฝะดะธะดะฐัะฐ = "ะงะธัะฐะปะบะฐ ะธััะพัะธะธ"
โโโ Header
โ   โโโ ะะผั, ะบะฐัะตะณะพัะธั, ะบะพะฝัะฐะบัั
โ   โโโ ะะฝะพะฟะบะฐ "ะะฐะฟะธัะฐัั ัะพะพะฑัะตะฝะธะต"
โโโ ะัะฝะพะฒะฝะฐั ะพะฑะปะฐััั (ัะฐะฑั)
โ   โโโ ะะบะปะฐะดะบะฐ "ะะฝะฐะปะธะทั" โ ัะฟะธัะพะบ ั ะฟัะพัะผะพััะพะผ
โ   โโโ ะะบะปะฐะดะบะฐ "ะะพะบัะผะตะฝัั" โ ัะฟะธัะพะบ ั ัะตะดะฐะบัะธัะพะฒะฐะฝะธะตะผ
โ   โโโ ะะบะปะฐะดะบะฐ "ะะฝัะตัะฒัั" โ ัะฟะธัะพะบ ั ะฟัะพัะพะบะพะปะฐะผะธ
โ   โโโ ะะบะปะฐะดะบะฐ "ะะฝัะพัะผะฐัะธั" โ ะพะฟัั, ะพะฑัะฐะทะพะฒะฐะฝะธะต, ะฝะฐะฒัะบะธ
โโโ ะัะต ะณะตะฝะตัะฐัะธะธ โ ะฒ ะฒะพัะพะฝะบั!
```

**ะัะตะธะผััะตััะฒะฐ:**
- ะงะธัะต ะธ ะฟะพะฝััะฝะตะต
- ะะตั ะดัะฑะปะธัะพะฒะฐะฝะธั ั ะฒะพัะพะฝะบะพะน
- ะคะพะบัั ะฝะฐ ะธััะพัะธะธ ะฒะทะฐะธะผะพะดะตะนััะฒะธะน
- ะััััะฐั ะฝะฐะฒะธะณะฐัะธั ัะตัะตะท ัะฐะฑั

---

## ๐ ะะะขะะะะะฆะะฏ ะะะะะะะฆะะ ะะะะฃะะะะขะะ

### ะะพะฒะฐั ะปะพะณะธะบะฐ (ะฒัััะพะตะฝะฐ ะฒ ะฒะพัะพะฝะบั):

#### ะัะธะณะปะฐัะตะฝะธะต ะฝะฐ ะธะฝัะตัะฒัั
**ะัะปะพ:** ะัะดะตะปัะฝะฐั ะบะฝะพะฟะบะฐ ะฝะฐ ัััะฐะฝะธัะต ะฟัะพัะธะปั  
**ะกัะฐะฝะตั:** ะ ะฒะพัะพะฝะบะต ะฝะฐ ััะฐัััะต `evaluated`, ะฟัะธ ะบะปะธะบะต "ะัะธะณะปะฐัะธัั ะฝะฐ ะธะฝัะตัะฒัั":

```typescript
const handleInviteToInterview = async () => {
  // 1. ะะตะฝะตัะธััะตะผ interview_session (ะฟะปะฐะฝ ะธะฝัะตัะฒัั)
  const session = await generateInterviewPlan({
    candidateId,
    vacancyId,
    organizationId,
    hrSpecialistId
  })
  
  // 2. ะะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะฒะพะดะธะผ ะฒ interview
  await updateApplicationStatus(applicationId, 'interview')
  
  // 3. Toast ั ะดะตะนััะฒะธะตะผ
  toast.success("ะะปะฐะฝ ะธะฝัะตัะฒัั ะณะพัะพะฒ", {
    action: {
      label: "ะัะบัััั",
      onClick: () => openInterviewWorkspace(session.id)
    }
  })
}
```

#### Job Offer
**ะัะปะพ:** ะัะดะตะปัะฝะฐั ะบะฝะพะฟะบะฐ  
**ะกัะฐะฝะตั:** ะ ะฒะพัะพะฝะบะต ะฝะฐ ััะฐัััะต `interview` (ะฟะพัะปะต ะทะฐะฒะตััะตะฝะธั ะธะฝัะตัะฒัั ั hire*):

```typescript
const handleSendOffer = async () => {
  // 1. ะะตะฝะตัะธััะตะผ ะพััะตั (Edge Function)
  const offer = await generateDocument({
    candidateId,
    vacancyId,
    documentType: 'job_offer',
    additionalInfo: '', // HR ะผะพะถะตั ะดะพะฑะฐะฒะธัั ะฟะตัะตะด ะณะตะฝะตัะฐัะธะตะน
    language: 'ru'
  })
  
  // 2. ะะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตะฒะพะดะธะผ ะฒ offer
  await updateApplicationStatus(applicationId, 'offer')
  
  // 3. ะะพะผะตัะฐะตะผ ะดะพะบัะผะตะฝั ะบะฐะบ ะพัะฟัะฐะฒะปะตะฝะฝัะน
  await updateApplication(applicationId, {
    sent_documents: [...sent_documents, 'offer']
  })
  
  // 4. ะะพะบะฐะทัะฒะฐะตะผ ะพััะตั ะดะปั ัะตะดะฐะบัะธัะพะฒะฐะฝะธั (optional)
  showDocumentPreview(offer.id)
}
```

#### Rejection Letter
**ะัะปะพ:** ะัะดะตะปัะฝะฐั ะบะฝะพะฟะบะฐ  
**ะกัะฐะฝะตั:** ะะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ะฟะตัะตะฒะพะดะต ะฒ `rejected`:

```typescript
const handleMoveToRejected = async (applicationId: string) => {
  // ะะพะบะฐะทัะฒะฐะตะผ ะดะธะฐะปะพะณ ั ะฒะพะฟัะพัะพะผ ะพ ะฟะธััะผะต
  const shouldGenerateLetter = await showDialog({
    title: "ะัะบะปะพะฝะธัั ะบะฐะฝะดะธะดะฐัะฐ?",
    description: "ะะตะบะพะผะตะฝะดัะตะผ ะพัะฟัะฐะฒะธัั ะฒะตะถะปะธะฒะพะต ะฟะธััะผะพ-ะพัะบะฐะท",
    actions: [
      { label: "ะัะบะปะพะฝะธัั ะฑะตะท ะฟะธััะผะฐ", value: false },
      { label: "ะกะณะตะฝะตัะธัะพะฒะฐัั ะฟะธััะผะพ", value: true }
    ]
  })
  
  // ะะฑะฝะพะฒะปัะตะผ ััะฐััั
  await updateApplicationStatus(applicationId, 'rejected')
  
  // ะัะปะธ ะฒัะฑัะฐะปะธ ะณะตะฝะตัะฐัะธั
  if (shouldGenerateLetter) {
    await generateDocument({
      candidateId,
      documentType: 'rejection_letter',
      language: 'ru'
    })
  }
}
```

---

## ๐ญ ะะะขะะะะะฆะะฏ "ะะะะะซะ ะะะะะะ" ะ "ะกะะะะะะะะ"

### ะะพะปะฝัะน ะฐะฝะฐะปะธะท - ัะผะฝะฐั ะณะตะฝะตัะฐัะธั

**ะขัะธะณะณะตั ะณะตะฝะตัะฐัะธะธ:**
1. **ะะฒัะพะผะฐัะธัะตัะบะธะน promopt** ะฟัะธ ะฟะตัะตัะพะดะต ะฒ `evaluated`:
   - Toast: "ะะฐะฝะดะธะดะฐั ะฟัะพัะตะป ะฒัะต ัะตััั! ะะตะบะพะผะตะฝะดัะตะผ ะฟัะพะฒะตััะธ ะฟะพะปะฝัะน AI-ะฐะฝะฐะปะธะท"
   - ะะตะนััะฒะธะต ะฒ toast: "ะกะณะตะฝะตัะธัะพะฒะฐัั" (ะฟััะผะพ ะธะท ัะฒะตะดะพะผะปะตะฝะธั)

2. **ะ ะบะฐััะพัะบะต `evaluated`:**
   - ะัะปะธ ะะะข ะฐะฝะฐะปะธะทะฐ โ ััะบะฐั ะบะฝะพะฟะบะฐ "๐ ะะพะปะฝัะน ะฐะฝะฐะปะธะท"
   - ะัะปะธ ะะกะขะฌ ะฐะฝะฐะปะธะท โ badge "ะะฝะฐะปะธะท ะณะพัะพะฒ" + ะบะฝะพะฟะบะฐ "ะัะพัะผะพััะตัั"

**ะัะธ ะณะตะฝะตัะฐัะธะธ:**
```typescript
const handleGenerateAnalysis = async () => {
  // ะะพะบะฐะทัะฒะฐะตะผ ะผะพะดะฐะปัะฝะพะต ะพะบะฝะพ ะณะตะฝะตัะฐัะธะธ
  showAIGenerationModal()
  
  // ะะตะฝะตัะธััะตะผ
  const analysis = await generateFullAnalysis({
    candidateId,
    vacancyIds: [vacancyId], // ัะตะบััะฐั ะฒะฐะบะฐะฝัะธั
    organizationId,
    hrSpecialistId,
    language: 'ru'
  })
  
  // ะะพะผะตัะฐะตะผ ะฒ application
  await updateApplication(applicationId, {
    has_full_analysis: true
  })
  
  // ะะพะบะฐะทัะฒะฐะตะผ ัะตะทัะปััะฐั ะฒ overlay (ะฝะต ััะพะดะธะผ ั ะฒะพัะพะฝะบะธ)
  showAnalysisOverlay(analysis)
}
```

### ะกัะฐะฒะฝะตะฝะธะต ะบะฐะฝะดะธะดะฐัะพะฒ - ะฒ ะฟัะพัะธะปะต ะฒะฐะบะฐะฝัะธะธ

**ะะพะฒะพะต ะผะตััะพ:** ะะฐ ัััะฐะฝะธัะต `/hr/vacancy/:id/profile` (ะณะดะต ideal_profile)

**ะะพะฑะฐะฒะปัะตะผ ะฒะบะปะฐะดะบั "ะกัะฐะฒะฝะตะฝะธะต":**
```
ะะบะปะฐะดะบะธ ะฝะฐ ัััะฐะฝะธัะต ะฒะฐะบะฐะฝัะธะธ:
โโโ ะะดะตะฐะปัะฝัะน ะฟัะพัะธะปั (ัะตะบััะตะต)
โโโ ๐ ะกัะฐะฒะฝะตะฝะธะต ะบะฐะฝะดะธะดะฐัะพะฒ (ะฝะพะฒะพะต)
โโโ ะะพัะพะฝะบะฐ (ัััะปะบะฐ)
```

**UI ะฒะบะปะฐะดะบะธ "ะกัะฐะฒะฝะตะฝะธะต":**
- ะกะฟะธัะพะบ ะฒัะตั ะบะฐะฝะดะธะดะฐัะพะฒ ะฒ ััะฐัััะต `evaluated` ะธะปะธ `interview`
- ะัะฑะพั 2-5 ะบะฐะฝะดะธะดะฐัะพะฒ ัะตัะตะท checkbox
- ะะฝะพะฟะบะฐ "ะกัะฐะฒะฝะธัั ะฒัะฑัะฐะฝะฝัั"
- ะััะพัะธั ััะฐะฒะฝะตะฝะธะน ั ะดะฐัะฐะผะธ

**ะญัะพ ะปะพะณะธัะฝะตะต ัะตะผ:**
- ะ ะฒะพัะพะฝะบะต (ัะปะธัะบะพะผ ะผะฝะพะณะพ ะดะตะนััะฒะธะน ะฒ ะบะฐััะพัะบะต)
- ะ ะฟัะพัะธะปะต ะบะฐะฝะดะธะดะฐัะฐ (ััะฐะฒะฝะตะฝะธะต ััะพ ะฟัะพ ะฒะฐะบะฐะฝัะธั, ะฝะต ะฟัะพ ะพะดะฝะพะณะพ ะบะฐะฝะดะธะดะฐัะฐ)

---

## ๐ ะะะะ ะะะะะะฆะะ ะ ะะะคะะะขะะะะะะ

### ะะฐะทะฐ ะดะฐะฝะฝัั (3 ะผะธะณัะฐัะธะธ):

1. **`0078_add_application_tracking.sql`:**
   - ะกะพะทะดะฐัั ัะฐะฑะปะธัั `application_timeline`
   - ะะพะฑะฐะฒะธัั ะฟะพะปั ะฒ `applications`: `has_full_analysis`, `latest_interview_id`, `interview_recommendation`, `sent_documents`
   - ะะฝะดะตะบัั

2. **`0079_auto_status_transitions.sql`:**
   - ะกะพะทะดะฐัั ััะฝะบัะธั `auto_update_application_status()`
   - ะกะพะทะดะฐัั ััะธะณะณะตั ะฝะฐ `candidates.tests_completed`
   - ะกะพะทะดะฐัั RPC `link_interview_to_application`

3. **`0080_update_interview_completion.sql`:**
   - ะะฑะฝะพะฒะธัั RPC `complete_interview_session` ะดะปั ะฐะฒัะพะฒัะทะพะฒะฐ `link_interview_to_application`

### Frontend (8 ัะฐะนะปะพะฒ):

1. **`CandidateCard.tsx`** - ะฟะพะปะฝะฐั ะฟะตัะตัะฐะฑะพัะบะฐ ั ัะผะฝัะผะธ badges ะธ ะบะพะฝัะตะบััะฝัะผะธ ะดะตะนััะฒะธัะผะธ
2. **`VacancyFunnel.tsx`** - ะดะพะฑะฐะฒะธัั ะพะฑัะฐะฑะพัะบั ะฝะพะฒัั ะดะตะนััะฒะธะน (ะณะตะฝะตัะฐัะธั ะฐะฝะฐะปะธะทะฐ, ะฟัะธะณะปะฐัะตะฝะธะต ะฝะฐ ะธะฝัะตัะฒัั)
3. **`CandidateProfilePage.tsx`** - ัะฟัะพััะธัั, ัะฑัะฐัั ะบะฝะพะฟะบะธ ะณะตะฝะตัะฐัะธะธ, ะดะพะฑะฐะฒะธัั ัะฐะฑั
4. **`VacancyProfilePage.tsx`** - ะดะพะฑะฐะฒะธัั ะฒะบะปะฐะดะบั "ะกัะฐะฒะฝะตะฝะธะต ะบะฐะฝะดะธะดะฐัะพะฒ"
5. **`InterviewCompletionDialog.tsx`** - ะดะพะฑะฐะฒะธัั ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ััะฐัััะฐ application
6. **ะะพะฒัะน: `QuickAnalysisOverlay.tsx`** - ะผะพะดะฐะปัะฝะพะต ะพะบะฝะพ ะดะปั ะฟัะพัะผะพััะฐ ะฐะฝะฐะปะธะทะฐ ะฑะตะท ััะพะดะฐ ั ะฒะพัะพะฝะบะธ
7. **ะะพะฒัะน: `SmartActionButton.tsx`** - ะฟะตัะตะธัะฟะพะปัะทัะตะผะฐั ะบะฝะพะฟะบะฐ ั ะธะบะพะฝะบะพะน, ัะฒะตัะพะผ, ะฟัะปััะฐัะธะตะน
8. **ะขะธะฟั: `application.ts`** - ัะฐััะธัะธัั ัะธะฟ Application

---

## ๐ฌ ะกะฆะะะะะะ ะะกะะะะฌะะะะะะะฏ (NEW)

### ะกัะตะฝะฐัะธะน 1: "ะัััััะน ะฝะฐะนะผ" (hire_strongly)
```
1. HR ะดะพะฑะฐะฒะปัะตั ะบะฐะฝะดะธะดะฐัะฐ ะฒ ะฒะพัะพะฝะบั โ [invited]
2. ะะฐะฝะดะธะดะฐั ะฝะฐัะธะฝะฐะตั ัะตััั โ ะฐะฒัะพะผะฐัะพะผ [testing] (badge "1/6")
3. ะะฐะฝะดะธะดะฐั ะทะฐะฒะตััะฐะตั 6/6 โ ะฐะฒัะพะผะฐัะพะผ [evaluated] (toast "ะะพัะพะฒ ะบ ะฐะฝะฐะปะธะทั!")
4. HR ะฒ ะฒะพัะพะฝะบะต ะบะปะธะบะฐะตั "๐ ะะพะปะฝัะน ะฐะฝะฐะปะธะท" โ ะณะตะฝะตัะธััะตััั ะทะฐ 30ัะตะบ
5. HR ะบะปะธะบะฐะตั "๐ ะัะธะณะปะฐัะธัั ะฝะฐ ะธะฝัะตัะฒัั" โ ะฟะปะฐะฝ ะณะพัะพะฒ, [interview]
6. HR ะฟัะพะฒะพะดะธั ะธะฝัะตัะฒัั (ัะตะบะฑะพะบัั, ะพัะตะฝะบะธ) โ ัะตะบะพะผะตะฝะดะฐัะธั: hire_strongly
7. ะ ะบะฐััะพัะบะต ะฟะพัะฒะปัะตััั ะฟัะปััะธััััะฐั ะบะฝะพะฟะบะฐ "๐ผ ะัะฟัะฐะฒะธัั ะพััะตั"
8. HR ะบะปะธะบะฐะตั โ ะพััะตั ะณะตะฝะตัะธััะตััั, ััะฐััั [offer]
9. ะะฐะฝะดะธะดะฐั ะฟัะธะฝะธะผะฐะตั โ HR ะบะปะธะบะฐะตั "ะัะธะฝัะป" โ [hired] ๐

ะัะพะณะพ: 6 ะบะปะธะบะพะฒ HR + ะฐะฒัะพะผะฐัะธะบะฐ
```

### ะกัะตะฝะฐัะธะน 2: "ะัะบะฐะท ะฝะฐ ะธะฝัะตัะฒัั" (reject)
```
1-6. ะะฝะฐะปะพะณะธัะฝะพ ััะตะฝะฐัะธั 1
7. HR ะฟัะพะฒะพะดะธั ะธะฝัะตัะฒัั โ ัะตะบะพะผะตะฝะดะฐัะธั: reject
8. ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ:
   - ะะตัะตะฒะพะดะธั ะฒ [rejected]
   - ะะพะบะฐะทัะฒะฐะตั ะดะธะฐะปะพะณ "ะกะณะตะฝะตัะธัะพะฒะฐัั ะฟะธััะผะพ-ะพัะบะฐะท?"
9. HR ะฒัะฑะธัะฐะตั "ะะฐ" โ ะฟะธััะผะพ ะณะตะฝะตัะธััะตััั ะธ ะพัะฟัะฐะฒะปัะตััั

ะัะพะณะพ: 1 ะบะปะธะบ HR ะฟะพัะปะต ะธะฝัะตัะฒัั
```

### ะกัะตะฝะฐัะธะน 3: "ะกัะฐะฒะฝะตะฝะธะต ะฟะตัะตะด ะธะฝัะตัะฒัั"
```
1. HR ะธะผะตะตั 3 ะบะฐะฝะดะธะดะฐัะพะฒ ะฒ [evaluated]
2. ะะตัะตัะพะดะธั ะฝะฐ ัััะฐะฝะธัั ะฒะฐะบะฐะฝัะธะธ โ ะฒะบะปะฐะดะบะฐ "ะกัะฐะฒะฝะตะฝะธะต"
3. ะัะฑะธัะฐะตั 3 ะบะฐะฝะดะธะดะฐัะพะฒ โ ะบะปะธะบะฐะตั "ะกัะฐะฒะฝะธัั"
4. ะะธะดะธั ัะตะนัะธะฝะณ: ะะฒะฐะฝ (95%), ะะตัั (87%), ะะฐัะธั (78%)
5. ะัะธะฝะธะผะฐะตั ัะตัะตะฝะธะต ะบะพะณะพ ะฟัะธะณะปะฐัะฐัั ะฟะตัะฒัะผ
6. ะะพะทะฒัะฐัะฐะตััั ะฒ ะฒะพัะพะฝะบั โ "ะัะธะณะปะฐัะธัั ะฝะฐ ะธะฝัะตัะฒัั" (ะะฒะฐะฝ)
```

---

## โก ะะะะะะฃะฉะะกะขะะ ะะะะะ ะะะฅะะขะะะขะฃะะซ

### ะะปั HR-ัะฟะตัะธะฐะปะธััะฐ:
โ **ะะตะฝััะต ะบะปะธะบะพะฒ** - ะฒัะต ะดะตะนััะฒะธั ะฒ ะบะพะฝัะตะบััะต ััะฐัััะฐ  
โ **ะะตั ัััะธะฝั** - ะฐะฒัะพะผะฐัะธะบะฐ ะดะปั ัะตััะธัะพะฒะฐะฝะธั  
โ **ะฃะผะฝัะต ะฟะพะดัะบะฐะทะบะธ** - ัะธััะตะผะฐ ะฟัะตะดะปะฐะณะฐะตั ัะปะตะดัััะธะน ัะฐะณ  
โ **ะะธะดะธะผะพััั ะฟัะพะณัะตััะฐ** - badges ะพะฑะฝะพะฒะปััััั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ  
โ **ะััะพัะธั ะดะตะนััะฒะธะน** - timeline ะดะปั ะฐัะดะธัะฐ  

### ะะปั ัะฐะทัะฐะฑะพัะบะธ:
โ **ะะตะฝััะต ะดัะฑะปะธัะพะฒะฐะฝะธั** - ะพะดะฝะฐ ัะพัะบะฐ ะณะตะฝะตัะฐัะธะธ ะดะปั ะบะฐะถะดะพะณะพ ัะธะฟะฐ  
โ **ะะพะณะธัะฝะฐั ะฐััะธัะตะบัััะฐ** - ะฒะพัะพะฝะบะฐ = ะธััะพัะฝะธะบ ะฟัะฐะฒะดั  
โ **ะัะพัััะต ััะธะณะณะตัั** - 2 ะฐะฒัะพะฟะตัะตัะพะดะฐ, ะพััะฐะปัะฝะพะต ัััะฝะพะต  
โ **ะะฐััะธััะตะผะพััั** - ะปะตะณะบะพ ะดะพะฑะฐะฒะปััั ะฝะพะฒัะต ััะฐัััั/ะดะตะนััะฒะธั  

### ะะปั ะฑะธะทะฝะตัะฐ:
โ **ะััััะตะต ะฝะฐะนะผ** - ะฐะฒัะพะผะฐัะธะบะฐ ัะบะพะฝะพะผะธั ะฒัะตะผั  
โ **ะะตะฝััะต ะพัะธะฑะพะบ** - ัะธััะตะผะฐ ะฝะต ะทะฐะฑัะฒะฐะตั ัะฐะณะธ  
โ **ะัััะธะน ะพะฟัั** - ะบะฐะฝะดะธะดะฐัั ะฟะพะปััะฐัั ะฑัััััั ะพะฑัะฐัะฝัั ัะฒัะทั  
โ **ะะฝะฐะปะธัะธะบะฐ** - timeline ะดะฐะตั ะฟะพะปะฝัั ะบะฐััะธะฝั ะฟัะพัะตััะฐ  

---

## ๐ MERMAID ะะะะะะะะะซ

### ะะพะปะฝัะน user flow ั ะธะฝัะตะณัะฐัะธะตะน

```mermaid
sequenceDiagram
    participant HR
    participant Funnel as ะะพัะพะฝะบะฐ
    participant System as ะกะธััะตะผะฐ
    participant AI
    participant Candidate as ะะฐะฝะดะธะดะฐั
    
    HR->>Funnel: ะะพะฑะฐะฒะธัั ะบะฐะฝะดะธะดะฐัะฐ
    Funnel->>System: CREATE application (invited)
    
    Candidate->>System: ะะฐัะธะฝะฐะตั ะฟะตัะฒัะน ัะตัั
    System->>Funnel: AUTO: invited โ testing
    
    Candidate->>System: ะะฐะฒะตััะฐะตั 6/6 ัะตััะพะฒ
    System->>Funnel: AUTO: testing โ evaluated
    System->>HR: Toast: "ะะฒะฐะฝ ะณะพัะพะฒ ะบ ะฐะฝะฐะปะธะทั!"
    
    HR->>Funnel: ะะปะธะบ "ะะพะปะฝัะน ะฐะฝะฐะปะธะท"
    Funnel->>AI: generateFullAnalysis()
    AI-->>Funnel: analysis.json + markdown
    Funnel->>HR: ะะพะบะฐะทะฐัั overlay ั ัะตะทัะปััะฐัะพะผ
    
    HR->>Funnel: ะะปะธะบ "ะัะธะณะปะฐัะธัั ะฝะฐ ะธะฝัะตัะฒัั"
    Funnel->>AI: generateInterviewPlan()
    AI-->>Funnel: interview_session (planned)
    Funnel->>System: UPDATE: evaluated โ interview
    System->>HR: Toast: "ะะปะฐะฝ ะณะพัะพะฒ"
    
    HR->>Funnel: ะะปะธะบ "ะัะพะฒะตััะธ ะธะฝัะตัะฒัั"
    Funnel->>HR: ะัะบัััั InterviewWorkspace
    HR->>System: ะะฐะฟะพะปะฝัะตั ัะตะบะฑะพะบัั, ะพัะตะฝะบะธ
    HR->>System: ะะฐะฒะตััะฐะตั (recommendation: hire_strongly)
    System->>Funnel: UPDATE: interview_recommendation
    Funnel->>HR: ะะพะบะฐะทะฐัั ะบะฝะพะฟะบั "ะัะฟัะฐะฒะธัั ะพััะตั" (ะฟัะปััะธััะตั)
    
    HR->>Funnel: ะะปะธะบ "ะัะฟัะฐะฒะธัั ะพััะตั"
    Funnel->>AI: generateDocument('job_offer')
    AI-->>Funnel: offer.markdown
    Funnel->>System: UPDATE: interview โ offer
    System->>Candidate: ะัะฟัะฐะฒะธัั ัะฒะตะดะพะผะปะตะฝะธะต
    
    Candidate->>System: ะัะธะฝะธะผะฐะตั ะพััะตั
    HR->>Funnel: ะะปะธะบ "ะัะธะฝัะป ะพััะตั"
    Funnel->>System: UPDATE: offer โ hired
    System->>HR: ะะพะฝัะตััะธ ๐
```

### ะััะธัะตะบัััะฐ ะดะฐะฝะฝัั

```mermaid
erDiagram
    applications ||--o{ application_timeline : has
    applications ||--o| interview_sessions : "latest_interview_id"
    applications ||--|| candidates : references
    applications ||--|| vacancies : references
    
    applications {
        uuid id PK
        text status
        boolean has_full_analysis
        uuid latest_interview_id FK
        text interview_recommendation
        jsonb sent_documents
    }
    
    application_timeline {
        uuid id PK
        uuid application_id FK
        text event_type
        text triggered_by
        jsonb details
        timestamptz created_at
    }
    
    interview_sessions {
        uuid id PK
        text status
        jsonb interview_plan
        jsonb session_data
    }
```

---

## ๐๏ธ ะะะะ ะะะะะะะะฆะะ (ะะพัะฐะณะพะฒัะน)

### ะญัะฐะฟ 1: ะะฐะทะฐ ะดะฐะฝะฝัั ะธ ััะธะณะณะตัั (2-3 ัะฐัะฐ)
- [ ] ะะธะณัะฐัะธั 0078: ะฝะพะฒัะต ัะฐะฑะปะธัั ะธ ะฟะพะปั
- [ ] ะะธะณัะฐัะธั 0079: ะฐะฒัะพะฟะตัะตัะพะดั ะดะปั ัะตััะพะฒ
- [ ] ะะธะณัะฐัะธั 0080: ะธะฝัะตะณัะฐัะธั ะธะฝัะตัะฒัั
- [ ] ะขะตััะธัะพะฒะฐะฝะธะต ััะธะณะณะตัะพะฒ ะฝะฐ dev ะะ

### ะญัะฐะฟ 2: ะะฐััะธัะตะฝะฝะฐั ะบะฐััะพัะบะฐ (3-4 ัะฐัะฐ)
- [ ] ะะฑะฝะพะฒะธัั ัะธะฟั Application
- [ ] ะกะพะทะดะฐัั SmartActionButton ะบะพะผะฟะพะฝะตะฝั
- [ ] ะะตัะตะฟะธัะฐัั CandidateCard ั ะดะธะฝะฐะผะธัะตัะบะธะผะธ badges
- [ ] ะะพะฑะฐะฒะธัั ะบะพะฝัะตะบััะฝัะต ะดะตะนััะฒะธั (getContextActions)
- [ ] ะะฝัะตะณัะธัะพะฒะฐัั ะฒ VacancyFunnel

### ะญัะฐะฟ 3: ะะฝัะตะณัะฐัะธั AI ะฒ ะฒะพัะพะฝะบั (4-5 ัะฐัะพะฒ)
- [ ] ะะพะฑะฐะฒะธัั ะพะฑัะฐะฑะพััะธะบะธ ะฒ VacancyFunnel:
  - handleGenerateAnalysis
  - handleInviteToInterview
  - handleSendOffer
- [ ] ะกะพะทะดะฐัั QuickAnalysisOverlay ะดะปั ะฟัะพัะผะพััะฐ ะฑะตะท ััะพะดะฐ
- [ ] ะะฑะฝะพะฒะธัั InterviewCompletionDialog ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั application
- [ ] ะะพะฑะฐะฒะธัั toast-ัะฒะตะดะพะผะปะตะฝะธั ั ะดะตะนััะฒะธัะผะธ

### ะญัะฐะฟ 4: ะฃะฟัะพัะตะฝะธะต ะฟัะพัะธะปั ะบะฐะฝะดะธะดะฐัะฐ (2-3 ัะฐัะฐ)
- [ ] ะฃะฑัะฐัั ะบะฝะพะฟะบะธ ะณะตะฝะตัะฐัะธะธ ะธะท ะฟัะฐะฒะพะน ะบะพะปะพะฝะบะธ
- [ ] ะะพะฑะฐะฒะธัั ัะฐะฑั (ะะฝะฐะปะธะทั | ะะพะบัะผะตะฝัั | ะะฝัะตัะฒัั | ะะฝัะพัะผะฐัะธั)
- [ ] ะะตัะตะฒะตัััะฐัั ะฟะพะด "ัะธัะฐะปะบั"
- [ ] ะะฑะฝะพะฒะธัั ะฟะตัะตะฒะพะดั

### ะญัะฐะฟ 5: ะกัะฐะฒะฝะตะฝะธะต ะฒ ะฟัะพัะธะปั ะฒะฐะบะฐะฝัะธะธ (2 ัะฐัะฐ)
- [ ] ะะพะฑะฐะฒะธัั ะฒะบะปะฐะดะบั "ะกัะฐะฒะฝะตะฝะธะต" ะฒ VacancyProfilePage
- [ ] ะะตัะตะผะตััะธัั CompareCandidatesDialog
- [ ] ะฃะฑัะฐัั ะธะท ะฟัะพัะธะปั ะบะฐะฝะดะธะดะฐัะฐ

### ะญัะฐะฟ 6: ะขะตััะธัะพะฒะฐะฝะธะต (2-3 ัะฐัะฐ)
- [ ] ะัะพะนัะธ ะฟะพะปะฝัะน flow ะพั invited ะดะพ hired
- [ ] ะัะพะฒะตัะธัั ะฒัะต ะฐะฒัะพะฟะตัะตัะพะดั
- [ ] ะัะพะฒะตัะธัั ะณะตะฝะตัะฐัะธั ะดะพะบัะผะตะฝัะพะฒ ะธะท ะฒะพัะพะฝะบะธ
- [ ] ะัะพะฒะตัะธัั ะธะฝัะตะณัะฐัะธั ะธะฝัะตัะฒัั
- [ ] ะัะพะฒะตัะธัั ะฝะฐ ะผะพะฑะธะปัะฝัั

**ะัะพะณะพ: 15-20 ัะฐัะพะฒ ัะธััะพะน ัะฐะทัะฐะฑะพัะบะธ**

---

## ๐จ ะะะะฃะะะฌะะซะ MOCKUPS

### ะะฐััะพัะบะฐ ะฒ ััะฐัััะต EVALUATED

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ค ะะฒะฐะฝ ะะตััะพะฒ                    โฎ   โ
โ  Frontend Developer                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โ 6/6 ัะตััะพะฒ                          โ
โ  โ๏ธ ะะฝะฐะปะธะท ะฝะต ะฟัะพะฒะตะดะตะฝ                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  [๐ ะะพะปะฝัะน ะฐะฝะฐะปะธะท]       โ emerald     โ
โ  [๐ ะัะธะณะปะฐัะธัั ะฝะฐ ะธะฝัะตัะฒัั] โ default  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะัะพัะธะปั ยท ะงะฐั                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะฐััะพัะบะฐ ะฒ ััะฐัััะต INTERVIEW (ะฟะพัะปะต ะทะฐะฒะตััะตะฝะธั ั hire_strongly)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ค ะะฒะฐะฝ ะะตััะพะฒ                    โฎ   โ
โ  Frontend Developer                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โ 6/6 ัะตััะพะฒ                          โ
โ  โจ ะะฐะฝััั ะฝะตะผะตะดะปะตะฝะฝะพ! (ะฟัะปััะฐัะธั)      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  [๐ผ ะัะฟัะฐะฒะธัั ะพััะตั]    โ emerald      โ
โ  [๐ ะัะพัะผะพััะตัั ะฟัะพัะพะบะพะป]              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะัะพัะธะปั ยท ะงะฐั                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐จ ะะะกะะ ะ ะะะขะะะะฆะะฏ

### ะะธัะบ 1: ะะฒัะพะฟะตัะตัะพะดั ะผะพะณัั ะฑััั ะฝะตะพะถะธะดะฐะฝะฝัะผะธ
**ะะธัะธะณะฐัะธั:** 
- Toast-ัะฒะตะดะพะผะปะตะฝะธั ะฟัะธ ะบะฐะถะดะพะผ ะฐะฒัะพะฟะตัะตัะพะดะต
- ะ timeline ะฒะธะดะฝะฐ ะธััะพัะธั ั ะฟะพะผะตัะบะพะน "system"
- HR ะผะพะถะตั ะฒัััะฝัั ะฒะตัะฝััั ะฝะฐะทะฐะด ัะตัะตะท "ะะตัะตะผะตััะธัั"

### ะะธัะบ 2: ะะฝะพะถะตััะฒะพ ะบะฝะพะฟะพะบ ะฒ ะบะฐััะพัะบะต
**ะะธัะธะณะฐัะธั:**
- ะะพะบะฐะทัะฒะฐะตะผ ัะพะปัะบะพ ะบะพะฝัะตะบััะฝัะต (max 2 ะพัะฝะพะฒะฝัะต)
- ะััะฐะปัะฝะพะต ะฒ ะฒัะฟะฐะดะฐััะตะผ ะผะตะฝั (โฎ)
- ะะฐ ะผะพะฑะธะปัะฝัั - accordion

### ะะธัะบ 3: ะกะปะพะถะฝะพััั ัะตะฐะปะธะทะฐัะธะธ ััะธะณะณะตัะพะฒ
**ะะธัะธะณะฐัะธั:**
- ะัะพัััะต IF/THEN ะฟัะพะฒะตัะบะธ
- ะะพะดัะพะฑะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒ timeline
- ะัะดะตะปัะฝะฐั ะผะธะณัะฐัะธั ะดะปั ะบะฐะถะดะพะณะพ ััะธะณะณะตัะฐ (ะพัะบะฐัะธัั ะปะตะณะบะพ)

---

## โจ ะะขะะะะะซะ ะะะะะะฃะฉะะกะขะะ

### ะะพ (ัะตะบััะตะต):
- 10+ ะบะปะธะบะพะฒ ะดะปั ะฝะฐะนะผะฐ ะพะดะฝะพะณะพ ะบะฐะฝะดะธะดะฐัะฐ
- ะะตั ะฒะธะดะธะผะพััะธ ะฟัะพะณัะตััะฐ
- AI-ััะฝะบัะธะธ ัะฐะทัะพะทะฝะตะฝั
- ะัะพัะธะปั ะบะฐะฝะดะธะดะฐัะฐ ะฟะตัะตะณััะถะตะฝ

### ะะพัะปะต (ะฝะพะฒะพะต):
- 5-6 ะบะปะธะบะพะฒ ะดะปั ะฝะฐะนะผะฐ โ
- ะะฒัะพะผะฐัะธะบะฐ ะดะปั ัััะธะฝั โ
- ะัะต AI ะฒ ะบะพะฝัะตะบััะต ะฒะพัะพะฝะบะธ โ
- ะะพะฝััะฝัะน flow ั ะฟะพะดัะบะฐะทะบะฐะผะธ โ
- Timeline ะดะปั ะฐัะดะธัะฐ โ

---

## ๐ฏ ะกะะะะฃะฎะฉะะ ะจะะ

ะะพัะปะต ะพะดะพะฑัะตะฝะธั ััะพะณะพ ะฟะปะฐะฝะฐ ะฟะตัะตะบะปััะฐะตะผัั ะฒ **Code mode** ะดะปั ัะตะฐะปะธะทะฐัะธะธ:

1. ะะฐัะธะฝะฐะตะผ ั ะผะธะณัะฐัะธะน ะะ (ะฑะตะทะพะฟะฐัะฝะพ, ะปะตะณะบะพ ะพัะบะฐัะธัั)
2. ะะพัะพะผ ัะตัะฐะบัะพัะธะผ CandidateCard
3. ะะฐัะตะผ ะธะฝัะตะณัะธััะตะผ ะฒ VacancyFunnel
4. ะคะธะฝะฐะปัะฝะพ - ัะฟัะพัะฐะตะผ ัััะฐะฝะธัั ะฟัะพัะธะปะตะน

**ะะพัะพะฒะพ ะบ ัะตะฐะปะธะทะฐัะธะธ!** ๐