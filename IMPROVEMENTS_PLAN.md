# План доработки HR Platform v2.0 (Production-Ready Audit)

Этот документ содержит результаты комплексного аудита кодовой базы и пошаговый план действий для доведения проекта до состояния Production-Ready.

---

## 1. Общие улучшения (Shared & Infrastructure)

### 1.1 UI/UX и Дизайн-система
- [ ] **Логотип и брендинг**: В `DashboardLayout.tsx` (строка 18) заменить заглушку `{/* TODO: Add Organization Logo and Name */}` на реальное отображение логотипа и названия организации из `useOrganization`.
- [ ] **Меню пользователя**: В `DashboardLayout.tsx` (строка 26) реализовать полноценное меню пользователя (DropdownMenu) с аватаром, именем, ссылкой на профиль и кнопкой "Выйти".
- [ ] **Пустые состояния (Empty States)**: Проверить все списки (вакансии, кандидаты, чаты) и убедиться, что везде используются красивые Empty State компоненты (как в `VacancyList.tsx`).
- [ ] **Уведомления (Toast)**: В `VacancyProfilePage` (строки 36, 39) заменить заглушки `// TODO: Add toast notification` на реальные вызовы `toast.success/error`.
- [ ] **Диалоги**: Избавиться от использования `createRoot` для вызова диалогов в `VacancyFunnel.tsx` (строки 183-284). Переписать на декларативный подход с использованием локального состояния (`useState`), как это сделано для `GenerateDocumentDialog`. Это критично для корректной работы контекстов (i18n, theme, queryClient).

### 1.2 Код и Типизация
- [ ] **ESLint**: Устранить все предупреждения линтера, особенно касающиеся зависимостей в `useEffect` и неиспользуемых переменных.
- [ ] **TypeScript**: Провести полный проход `tsc --noEmit` и устранить все ошибки типов, особенно использование `any` в сложных компонентах (например, `TalentMarketPage`).
- [ ] **API Клиент**: Централизовать обработку ошибок Supabase в `src/shared/lib/supabase.ts` или создать обертку для API вызовов, чтобы не дублировать логику `if (error) throw error` в каждом хуке.

---

## 2. Модуль Аутентификации (Auth)

### 2.1 Регистрация и Вход
- [ ] **Подтверждение Email**: Добавить обработку состояния, когда `signUp` возвращает пользователя, но email не подтвержден. Показывать пользователю информационный экран "Проверьте вашу почту". Текущий код сразу редиректит на `/`, что может привести к ошибкам.
- [ ] **Восстановление пароля**: Реализовать flow восстановления пароля ("Забыли пароль?"), так как сейчас он отсутствует.

---

## 3. Модуль Управления Вакансиями (Vacancy Management)

### 3.1 Список вакансий
- [ ] **Действия с вакансией**: В `VacancyList.tsx` (строки 64, 69) реализовать реальную логику для "Редактировать" (открытие диалога с предзаполненными данными) и "Архивировать" (вызов API метода смены статуса). Сейчас там только `console.log`.

### 3.2 Воронка (Funnel)
- [ ] **Оптимизация Drag & Drop**: Проверить производительность `VacancyFunnel` при большом количестве кандидатов (50+). Возможно, потребуется виртуализация списков.
- [ ] **Мобильная версия**: Адаптировать канбан-доску для мобильных устройств (горизонтальный скролл колонок или переключение табами).

---

## 4. Модуль Кандидатов и Тестирования (Candidate & Testing)

### 4.1 Дашборд кандидата
- [ ] **Заглушки**: В `CandidateDashboardPage` (строка 71) убрать `|| '...'` и добавить нормальный Skeleton при загрузке имени.
- [ ] **API Visibility**: Метод `handleProfileVisibilityChange` вынести из компонента в API слой (`src/features/candidate-management/api`).

### 4.2 Результаты тестов
- [ ] **Скачивание PDF**: В `TestResultsPage` (строка 115) реализовать реальную генерацию PDF отчета с результатами тестов (используя `jsPDF` или Edge Function). Сейчас это просто кнопка-заглушка.
- [ ] **Пересдача**: В `TestResultsPage` (строка 117) реализовать логику кнопки "Пересдать тест" с проверкой доступности (таймаут 1 месяц).

---

## 5. Модуль AI и Рынков талантов (AI & Talent Market)

### 5.1 Рынок талантов
- [ ] **Фильтры**: Убедиться, что сброс фильтров работает корректно.
- [ ] **Типизация**: Исправить `any` в `TalentMarketPage` (строка 86).

---

## 6. Модуль Чата и Платежей (Chat & Payments)

### 6.1 Покупка токенов
- [ ] **Безопасность**: Убедиться, что `RobokassaForm` (код которого был скрыт при просмотре) отправляет данные через POST и не светит секреты на клиенте (подпись должна генерироваться на бэкенде, что уже реализовано в `create-robokassa-invoice`).

### 6.2 Чат
- [ ] **Вложения**: Добавить возможность отправки файлов в чате (резюме, тестовые задания).
- [ ] **Статусы**: Реализовать отображение статуса "Прочитано" (две галочки) для отправленных сообщений.

---

## 7. Инфраструктура (DevOps & Backend)

### 7.1 Edge Functions
- [ ] **Переменные окружения**: Проверить, что все необходимые секреты (`SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY`, `ANTHROPIC_API_KEY`, `GEMINI_API_KEY`) добавлены в настройки проекта Supabase.
- [ ] **Обработка ошибок**: Убедиться, что все функции корректно возвращают JSON с ошибкой при сбоях, чтобы фронтенд мог показать тост.

### 7.2 База данных
- [ ] **Индексы**: Проверить наличие индексов на полях, используемых для фильтрации и сортировки в `talent-market` и `chat` (хотя миграции были применены, стоит перепроверить план выполнения запросов).
- [ ] **Бэкапы**: Настроить регулярное резервное копирование базы данных в Supabase (PITR).

---

## Приоритет выполнения

1. **Критические исправления (Critical)**:
   - Исправление `createRoot` в `VacancyFunnel` (может ломать приложение).
   - Реализация действий "Edit/Archive" вакансии.
   - Проверка переменных окружения для Edge Functions.

2. **Важные улучшения (High)**:
   - Меню пользователя и логотип организации.
   - Подтверждение Email и восстановление пароля.
   - Скачивание PDF результатов.

3. **Полировка (Medium)**:
   - Toast уведомления вместо TODO.
   - Устранение `any` и ошибок линтера.
   - Улучшение мобильной версии воронки.